% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  letterpaper,
  DIV=11,
  numbers=noendperiod]{scrreprt}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else  
    % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{5}
% Make \paragraph and \subparagraph free-standing
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newlength{\cslentryspacingunit} % times entry-spacing
\setlength{\cslentryspacingunit}{\parskip}
\newenvironment{CSLReferences}[2] % #1 hanging-ident, #2 entry spacing
 {% don't indent paragraphs
  \setlength{\parindent}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
  \let\oldpar\par
  \def\par{\hangindent=\cslhangindent\oldpar}
  \fi
  % set entry spacing
  \setlength{\parskip}{#2\cslentryspacingunit}
 }%
 {}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{#1}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{#1}\break}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}

\KOMAoption{captions}{tableheading}
\makeatletter
\@ifpackageloaded{tcolorbox}{}{\usepackage[skins,breakable]{tcolorbox}}
\@ifpackageloaded{fontawesome5}{}{\usepackage{fontawesome5}}
\definecolor{quarto-callout-color}{HTML}{909090}
\definecolor{quarto-callout-note-color}{HTML}{0758E5}
\definecolor{quarto-callout-important-color}{HTML}{CC1914}
\definecolor{quarto-callout-warning-color}{HTML}{EB9113}
\definecolor{quarto-callout-tip-color}{HTML}{00A047}
\definecolor{quarto-callout-caution-color}{HTML}{FC5300}
\definecolor{quarto-callout-color-frame}{HTML}{acacac}
\definecolor{quarto-callout-note-color-frame}{HTML}{4582ec}
\definecolor{quarto-callout-important-color-frame}{HTML}{d9534f}
\definecolor{quarto-callout-warning-color-frame}{HTML}{f0ad4e}
\definecolor{quarto-callout-tip-color-frame}{HTML}{02b875}
\definecolor{quarto-callout-caution-color-frame}{HTML}{fd7e14}
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{bookmark}{}{\usepackage{bookmark}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Fig}
\else
  \newcommand\figurename{Fig}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother
\makeatletter
\@ifpackageloaded{tcolorbox}{}{\usepackage[skins,breakable]{tcolorbox}}
\makeatother
\makeatletter
\@ifundefined{shadecolor}{\definecolor{shadecolor}{rgb}{.97, .97, .97}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\makeatother
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Experiment Cookbook},
  pdfauthor={Ali Seyhun Saral},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}

\title{Experiment Cookbook}
\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par}}{}{}
}
\makeatother
\subtitle{A tutorial on running experiments with oTree}
\author{Ali Seyhun Saral}
\date{2023-09-01}

\begin{document}
\maketitle
\ifdefined\Shaded\renewenvironment{Shaded}{\begin{tcolorbox}[interior hidden, boxrule=0pt, enhanced, sharp corners, frame hidden, breakable, borderline west={3pt}{0pt}{shadecolor}]}{\end{tcolorbox}}\fi

\renewcommand*\contentsname{Table of contents}
{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{2}
\tableofcontents
}
\bookmarksetup{startatroot}

\hypertarget{preface}{%
\chapter*{Preface}\label{preface}}
\addcontentsline{toc}{chapter}{Preface}

\markboth{Preface}{Preface}

Hey jude, don't make it bad

See Knuth (1984) for additional discussion of literate programming.

\hypertarget{acknowledgements}{%
\subsubsection*{Acknowledgements}\label{acknowledgements}}
\addcontentsline{toc}{subsubsection}{Acknowledgements}

Konstantinos Ioannidis - Chat between the experimenter and the
participant - Splitting your program into apps Filippo Toscano - Using
bots - Optimal app number/design - Variables in monitoring page - Live
pages Robert Böhm - Online recruitment platforms - Scheduling/dropout
management with bots - Server capacity Sandro Ambuehl - How to outsource
coding on upwork/fiver Jonas Frey Laura Hoenig - Different otree
versions. Various versions in one lab Tobias Werner - Object structure
Esra Dağlı - Live pages Stefan Schmidt - Live pages Ingar Haaland -
Interactive sliders - Constant sum

Christoph Engel Oliver Kirschkamp

\part{Introduction to oTree}

\part{Individual Decisions}

\hypertarget{creating-an-otree-project}{%
\chapter{Creating an oTree project}\label{creating-an-otree-project}}

An oTree project is a folder containing your experiment. You can
consider it as ``an experiment project''. Everytime you have a new
experiment, it is best to create a new project, and potentially install
oTree for your new project. (Don't worry, the moving parts(apps) like a
specific task, can be transferred from one project to another but that
is for a later chapter.)

In many software we used to, you install a software, somehow
independently from a project. And then you open the file of your project
with the software. For that reason this might somehow be confusing at
first. But once you get used to it, it is actually very convenient.

\hypertarget{how-to-create-a-new-project}{%
\section{How to create a new
project}\label{how-to-create-a-new-project}}

\begin{itemize}
\tightlist
\item
  First you need to open a terminal (or command prompt) window.
\item
  Then you need to navigate to the folder where you want to create your
  project in. This folder typically will contain two things:

  \begin{itemize}
  \tightlist
  \item
    Your project files (template generated by oTree)
  \item
    A virtual environment (folder containing all the packages you need
    for your project)
  \end{itemize}
\end{itemize}

Your virtual environment can live anywhere on your computer. But it is
convenient to have it in the same folder as your project files so you
don't have to look for it each time. See the section on virtual
environment for more details. See Chapter~\ref{sec-virtual-environments}
on Virtual Environments for more details.

\hypertarget{step-by-step-instructions}{%
\section{Step-by-step instructions}\label{step-by-step-instructions}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Create a new parent folder for your otree project and virtual
  envirionment.
\end{enumerate}

\begin{verbatim}
mkdir myexperiment
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Navigate to this folder
\end{enumerate}

\begin{verbatim}
cd myexperiment
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Create a virtual environment in this folder
\end{enumerate}

\begin{verbatim}
python3 -m venv venv
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Activate your virtual environment
\end{enumerate}

\begin{verbatim}
source venv/bin/activate
\end{verbatim}

or for windows

\begin{verbatim}
venv/Scripts/activate
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  Install oTree in your virtual environment
\end{enumerate}

\begin{verbatim}
pip install otree
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  Create a new oTree project
\end{enumerate}

\begin{verbatim}
otree startproject otreetest
\end{verbatim}

You will be asked whether to include sample games. Press `y' and enter
to include them.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{6}
\tightlist
\item
  Navigate to your project folder
\end{enumerate}

\begin{verbatim}
cd otreetest
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{7}
\tightlist
\item
  Run your project
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{otree devserver}
\end{Highlighting}
\end{Shaded}

You should see an output similar to this:

\begin{verbatim}
Open your browser to http://localhost:8000/
To quit the server, press Control+C.
\end{verbatim}

If so, your otree server should be running on your machine, unless you
stop (Ctrl+C) or close the terminal.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{8}
\tightlist
\item
  Now go ahead and test it. Open a browser and go to
  \url{http://localhost:8000} (you can simply click the link here). Try
  to navigate the menus and try to figure out their purposes.
\end{enumerate}

\hypertarget{section-appendix-installing-a-specific-version-of-otree}{%
\section{Section Appendix: Installing a specific version of
oTree}\label{section-appendix-installing-a-specific-version-of-otree}}

Sometimes you'd like to run a specific verson of oTree. For instance you
might need to reproduce an experiment or need a specific feature.

If you want to create a project with a specific version of oTree, you
can do so by specifying the version number when you install oTree in
your virtual environment. For example, if you want to install oTree
version 3.3.10, you can do so by running the following command on step
5:

\texttt{pip\ install\ otree==3.3.10}

\hypertarget{building-a-survey}{%
\chapter{Building a survey}\label{building-a-survey}}

Here is how to build a survey

\hypertarget{creating-the-project}{%
\subsection{Creating the project}\label{creating-the-project}}

\begin{itemize}
\tightlist
\item
  Lets create a new project for our experiment. Open your terminal and
  type the following command\footnote{If you are not sure why, please
    refer to the \protect\hyperlink{creating-an-otree-project}{Creating
    a project section}}.
\end{itemize}

\begin{verbatim}
otree startproject myexperiment
\end{verbatim}

\begin{itemize}
\item
  You will be promped to include sample games or not. You can choose
  either but to keep it simple, I suggest you not to (type ``n'' and
  press enter).
\item
  Now, you should see a new folder called ``myexperiment'' in your
  current directory. Let's go inside the folder and test if everything
  is working.
\end{itemize}

\begin{verbatim}
cd myexperiment
otree devserver
\end{verbatim}

\begin{itemize}
\tightlist
\item
  If everything is working and you can access to otree admin page, you
  can stop the server by pressing \texttt{Ctrl\ +\ C} and continue.
\end{itemize}

\hypertarget{creating-the-app}{%
\subsection{Creating the app}\label{creating-the-app}}

\begin{itemize}
\tightlist
\item
  This time before running experiment, we will create a new app, which
  will contain our survey.
\end{itemize}

\begin{verbatim}
otree startapp survey
\end{verbatim}

\begin{itemize}
\item
  This command creates a new folder called \texttt{survey} which
  contains a template for our app. We will be modifying the files in
  this folder to create our survey.
\item
  This doesn't add the app to our experiment yet. We also need to let
  oTree know that we would like to add this app to our experiment. For
  that, go to the \texttt{settings.py} (in our \texttt{myexperiment}
  directory) and modify the following lines.
\end{itemize}

\begin{codelisting}

\caption{\texttt{settings.py}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ...}

\NormalTok{SESSION\_CONFIGS }\OperatorTok{=}\NormalTok{ [}
     \BuiltInTok{dict}\NormalTok{(}
\NormalTok{         name}\OperatorTok{=}\StringTok{\textquotesingle{}my\_survey\textquotesingle{}}\NormalTok{,}
\NormalTok{         app\_sequence}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}survey\textquotesingle{}}\NormalTok{],}
\NormalTok{         num\_demo\_participants}\OperatorTok{=}\DecValTok{3}\NormalTok{,}
\NormalTok{     ),}
\NormalTok{]}

\CommentTok{\# ...}
\end{Highlighting}
\end{Shaded}

\end{codelisting}

Here we basically tell oTree that we would like to have a session called
\texttt{my\_survey} and it will only contain the app called
\texttt{survey}.

\begin{tcolorbox}[enhanced jigsaw, bottomrule=.15mm, titlerule=0mm, rightrule=.15mm, breakable, colframe=quarto-callout-note-color-frame, title=\textcolor{quarto-callout-note-color}{\faInfo}\hspace{0.5em}{A look at SESSION\_CONFIGS}, coltitle=black, colbacktitle=quarto-callout-note-color!10!white, colback=white, arc=.35mm, opacitybacktitle=0.6, bottomtitle=1mm, toptitle=1mm, leftrule=.75mm, toprule=.15mm, left=2mm, opacityback=0]

\texttt{SESSION\_CONFIGS} is a list of dictionaries defined in the
project settings file \texttt{settings.py}. Each dictionary represents a
set of configurations for an experiment session.

Here we add a new dictionary to the list. The dictionary has three keys:

\begin{itemize}
\item
  \texttt{name}: Name of the session configuration (you can choose any
  name you want, but it should be unique and contain only letters,
  numbers and underscores. No spaces or hypens are allowed.)
\item
  \texttt{app\_sequence}: List of apps that will be included in the
  session. In this case, we only have one app called \texttt{survey}.
\item
  \texttt{num\_demo\_participants}: oTree opens a ``test'' page by
  default called Demo. This is the number of links it creates for that
  demo. Usually same number or a multiple of the group size in an
  experiment. Not very important for the real experiment.
\end{itemize}

It is common to have one session config for each treatment.

\end{tcolorbox}

\begin{itemize}
\tightlist
\item
  Now, we can run the server again and see if our app is added to the
  experiment. First make sure that you are in the \texttt{myexperiment}
  directory and then run the server:
\end{itemize}

\begin{verbatim}
otree devserver
\end{verbatim}

\begin{itemize}
\tightlist
\item
  We can keep the server running while modifying the files. In most of
  the cases you don't need to restart the server to see the changes.
  (while using \texttt{devserver} which is for development.)
\end{itemize}

\hypertarget{structure-of-our-app}{%
\section{Structure of our app}\label{structure-of-our-app}}

oTree file and folder structure might look intimidating at first. But it
is not. Before we go any further, let's take a look at the structure of
our app.

\begin{verbatim}
myexperiment
├── __pycache__
├── _static
├── _templates
├── db.sqlite3
├── requirements.txt
├── settings.py
└── survey
    ├── MyPage.html
    ├── Results.html
    ├── __init__.py
\end{verbatim}

Directories and files we care about generally: - \texttt{\_static}: If
we have some files that oTree needs to access (e.g.~images) we put them
in this folder. - \texttt{survey} (or any other app folder): -
\texttt{\_\_init\_\_.py}: This file is where the real magic happens. We
will be writing our code mostly in this file. The logic of our app, data
related things etc. (back-end) will be in this file.

\begin{verbatim}
- `HTML files`:  In every app, we have an HTML file for each page. Most of the things user see (front-end) will be in these files.
\end{verbatim}

\begin{itemize}
\tightlist
\item
  \texttt{settings.py}: This is the main settings file for our
  experiment. We will be modifying this file to add new apps, add some
  variables we need throughout whole experiment here.
\end{itemize}

Let's take a look at the \texttt{\_\_init\_\_.py} file in our
\texttt{survey} folder. So far it looks like this.

\begin{codelisting}

\caption{\texttt{__init__.py}}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{from}\NormalTok{ otree.api }\ImportTok{import} \OperatorTok{*}


\NormalTok{doc }\OperatorTok{=} \StringTok{"""}
\StringTok{Your app description}
\StringTok{"""}


\KeywordTok{class}\NormalTok{ C(BaseConstants):}
\NormalTok{    NAME\_IN\_URL }\OperatorTok{=} \StringTok{\textquotesingle{}survey\textquotesingle{}}
\NormalTok{    PLAYERS\_PER\_GROUP }\OperatorTok{=} \VariableTok{None}
\NormalTok{    NUM\_ROUNDS }\OperatorTok{=} \DecValTok{1}


\KeywordTok{class}\NormalTok{ Subsession(BaseSubsession):}
    \ControlFlowTok{pass}


\KeywordTok{class}\NormalTok{ Group(BaseGroup):}
    \ControlFlowTok{pass}


\KeywordTok{class}\NormalTok{ Player(BasePlayer):}
    \ControlFlowTok{pass}


\CommentTok{\# PAGES}
\KeywordTok{class}\NormalTok{ MyPage(Page):}
    \ControlFlowTok{pass}


\KeywordTok{class}\NormalTok{ ResultsWaitPage(WaitPage):}
    \ControlFlowTok{pass}


\KeywordTok{class}\NormalTok{ Results(Page):}
    \ControlFlowTok{pass}


\NormalTok{page\_sequence }\OperatorTok{=}\NormalTok{ [MyPage, ResultsWaitPage, Results]}
\end{Highlighting}
\end{Shaded}

\end{codelisting}

\begin{itemize}
\tightlist
\item
  \texttt{doc}: This is a docstring. It is used to describe the app. It
  is not necessary but it is a good practice to have one.
\end{itemize}

\hypertarget{constants}{%
\subsubsection{Constants}\label{constants}}

\begin{itemize}
\tightlist
\item
  \texttt{C}: This is a class that contains some constants. We will be
  using this class to define some variables that we will be using
  throughout the experiment. For example, if we want to have a variable
  called \texttt{age} for each player, we can define it here.
\end{itemize}

\hypertarget{models}{%
\subsubsection{Models}\label{models}}

\begin{itemize}
\item
  \texttt{Subsession}, \texttt{Group}, \texttt{Player}: These are
  classes that represent the subsession, group and player. We will be
  using these classes to define the logic of our experiment. For
  example, if we want to have a variable called \texttt{age} for each
  player, we can define it here.
\item
  This part is necessary for every app and the names of the classes
  should be exactly the same. We often modify by adding new variables
  (attributes, if we want to be precise) to these classes
\end{itemize}

\hypertarget{pages}{%
\subsubsection{Pages}\label{pages}}

\begin{itemize}
\item
  \texttt{MyPage}, \texttt{ResultsWaitPage}, \texttt{Results}: These are
  classes that represent the pages in our app. We will be using these
  classes to define the pages in our app. For example, if we want to
  have a page called \texttt{MyPage} in our app, we can define it here.
\item
  We can delete the pages we don't need and add new pages freely. Each
  page is defined by a class. The name of the class is the name of the
  page. It inherits from \texttt{Page} class (or \texttt{WaitPage} if it
  is a wait page but we'll come to that later). And then a HTML file
  should accompany to the page with the same name. For example, if we
  have a page called \texttt{MyPage}, we should have a HTML file called
  \texttt{MyPage.html} in the same folder.
\end{itemize}

\hypertarget{page-sequence}{%
\subsubsection{Page sequence}\label{page-sequence}}

\begin{itemize}
\tightlist
\item
  \texttt{page\_sequence}: This is a list of pages that will be shown to
  the user. We will be using this list to define the order of the pages
  in our app. For example, if we want to have a page called
  \texttt{MyPage} in our app, we can add it to this list.
\end{itemize}

\hypertarget{prepare-the-files}{%
\subsection{Prepare the files}\label{prepare-the-files}}

\begin{itemize}
\tightlist
\item
  We can start by deleting the pages we don't need. Let's delete the
  following lines:
\end{itemize}

\begin{codelisting}

\caption{\texttt{__init__.py}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ...}
\KeywordTok{class}\NormalTok{ ResultsWaitPage(WaitPage):}
    \ControlFlowTok{pass}

\KeywordTok{class}\NormalTok{ Results(Page):}
    \ControlFlowTok{pass}
\end{Highlighting}
\end{Shaded}

\end{codelisting}

and remove them from the \texttt{page\_sequence} list. So it should look
like this:

\begin{codelisting}

\caption{\texttt{__init__.py}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ...}
\NormalTok{page\_sequence }\OperatorTok{=}\NormalTok{ [MyPage]}
\end{Highlighting}
\end{Shaded}

\end{codelisting}

\begin{itemize}
\tightlist
\item
  We can delete the \texttt{ResultsWaitPage.html} and
  \texttt{Results.html} files as well.
\end{itemize}

\hypertarget{looking-at-mypage.html}{%
\subsection{Looking at MyPage.html}\label{looking-at-mypage.html}}

Now lets take a look at \texttt{MyPage.html} file. Lets modify it a
little bit.

\begin{codelisting}

\caption{\texttt{MyPage.html}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{\{\{ block title \}\}}
\NormalTok{Welcome to our survey }
\NormalTok{\{\{ endblock \}\}}

\NormalTok{\{\% block content \%\}}

\NormalTok{    We would like you to answer the following questions. }
\NormalTok{    Please do not leave any question blank.}

\NormalTok{   \{\{ formfields \}\}}
\NormalTok{   \{\{next\_button\}\}}
\end{Highlighting}
\end{Shaded}

\end{codelisting}

As you can see it is formed of some text and some blocks and variables.

Let's take a look how it looks now:

\begin{figure}

{\centering \includegraphics{part_otree/survey_firstlook.png}

}

\caption{\label{fig-survey-firstlook}How our survey looks at this point.
No forms yet but we can modify the title and the text}

\end{figure}

\hypertarget{creating-our-survey.}{%
\subsection{Creating our survey.}\label{creating-our-survey.}}

When we start programming an individual experiment, we usually follow
these steps:

\begin{itemize}
\tightlist
\item
  Define the variables we need in \texttt{Player} class.
\item
  Create the pages classes.
\item
  Create the HTML files for each page.
\end{itemize}

For our survey, we need to ask the following questions:

\begin{itemize}
\tightlist
\item
  Age (Integer)
\item
  Country (will be saved as text: String.)
\item
  Any additional comments.
\end{itemize}

Now, let's add these variables to our \texttt{Player} class. Remember
that the way we create these field is by using the field types listed in
oTree
\href{https://otree.readthedocs.io/en/latest/models.html\#field-types}{documentation}.

\begin{codelisting}

\caption{\texttt{__init__.py}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ...}

\KeywordTok{class}\NormalTok{ Player(BasePlayer):}
\NormalTok{    age }\OperatorTok{=}\NormalTok{ models.IntegerField(label}\OperatorTok{=}\StringTok{\textquotesingle{}How old are you?\textquotesingle{}}\NormalTok{)}
\NormalTok{    country }\OperatorTok{=}\NormalTok{ models.StringField(label}\OperatorTok{=}\StringTok{\textquotesingle{}Please write the country you live in\textquotesingle{}}\NormalTok{)}
\NormalTok{    comments }\OperatorTok{=}\NormalTok{ models.LongStringField(label}\OperatorTok{=}\StringTok{\textquotesingle{}Please write your comments here\textquotesingle{}}\NormalTok{)}

\CommentTok{\# ...}
\end{Highlighting}
\end{Shaded}

\end{codelisting}

\begin{figure}

{\centering \includegraphics{part_otree/survey_dataadded.png}

}

\caption{\label{fig-survey-dataadded}Our fields appear in the data}

\end{figure}

Now that we have the required variables, their columns will appear in
the data. But we still need to tell oTree which page to put them.

We should go back to our \texttt{MyPage} class and add the fields we
want to show in this page.

We have to provide two things to oTree to show the fields in the page: -
\texttt{form\_model}: Who (which class) has the fields we want to get
the input to. We are programming an individual experiment and our
variables are in \texttt{Player} class. So we should write
\texttt{form\_model\ =\ \textquotesingle{}player\textquotesingle{}}.
This field expects a string of the class name. - \texttt{form\_fields}:
We should tell which fields want to get input to. This field expects the
names of the fields in a list.

Let's do it:

\begin{codelisting}

\caption{\texttt{__init__.py}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ...}
\KeywordTok{class}\NormalTok{ MyPage(Page):}
\NormalTok{    form\_model }\OperatorTok{=} \StringTok{\textquotesingle{}player\textquotesingle{}}
\NormalTok{    form\_fields }\OperatorTok{=}\NormalTok{ [}\StringTok{\textquotesingle{}age\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}country\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}comments\textquotesingle{}}\NormalTok{]}

\CommentTok{\# ...}
\end{Highlighting}
\end{Shaded}

\end{codelisting}

Now, we can go re-run our experiment and see how it looks now. Then lets
try it and see that the data is saved correctly.

\begin{figure}

{\centering \includegraphics{part_otree/survey_datacorrect1.png}

}

\caption{\label{fig-survey-datacorrect1}Survey fields are appears and
ready to take input. (We might need some tinkering with it though.)}

\end{figure}

\begin{figure}

{\centering \includegraphics{part_otree/survey_datacorrect2.png}

}

\caption{\label{fig-survey-datacorrect2}How participant input looks on
oTree control panel}

\end{figure}

\hypertarget{formatting-the-survey}{%
\subsection{Formatting the survey}\label{formatting-the-survey}}

We have a functional survey but participants should all the information
by themselves. It is better to provide some ready-made options for them
and set the limits. Luckily oTree provides some options for us. We can
add some arguments to the fields to modify them.

Let's start with the age. We can set the minimum and maximum age by
adding \texttt{min} and \texttt{max} arguments to the
\texttt{IntegerField}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{age }\OperatorTok{=}\NormalTok{ models.IntegerField(label}\OperatorTok{=}\StringTok{\textquotesingle{}How old are you?\textquotesingle{}}\NormalTok{, }\BuiltInTok{min}\OperatorTok{=}\DecValTok{18}\NormalTok{, }\BuiltInTok{max}\OperatorTok{=}\DecValTok{100}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Now if you try to add a value outside of this range, you will get a
pop-up warning.

Next, assume that we are running this experiment in few selected
countries. We can provide a list of countries to the
\texttt{StringField} by adding \texttt{choices} argument so that
participants can only choose from the list. This argument expects a list
of options.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{country }\OperatorTok{=}\NormalTok{ models.StringField(label}\OperatorTok{=}\StringTok{\textquotesingle{}Please write the country you live in\textquotesingle{}}\NormalTok{,}
\NormalTok{                            choices}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}Algeria\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Columbia\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}France\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Kenya\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Turkey\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Vietnam\textquotesingle{}}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

Next we would like to add radio buttons for each study year. We can do
this by adding \texttt{choices} argument to the \texttt{IntegerField}.
This argument expects a list of options. We can also add
\texttt{widget=widgets.RadioSelect} to make it a radio button.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{study\_year }\OperatorTok{=}\NormalTok{ models.IntegerField(label}\OperatorTok{=}\StringTok{\textquotesingle{}What is your study year?\textquotesingle{}}\NormalTok{,}
\NormalTok{                                 choices}\OperatorTok{=}\NormalTok{[}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{],}
\NormalTok{                                 widget}\OperatorTok{=}\NormalTok{widgets.RadioSelect)}
\end{Highlighting}
\end{Shaded}

This is how our code looks now:

\begin{codelisting}

\caption{\texttt{__init__.py}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ...}

\KeywordTok{class}\NormalTok{ Player(BasePlayer):}
\NormalTok{    age }\OperatorTok{=}\NormalTok{ models.IntegerField(label}\OperatorTok{=}\StringTok{\textquotesingle{}How old are you?\textquotesingle{}}\NormalTok{, }\BuiltInTok{min}\OperatorTok{=}\DecValTok{18}\NormalTok{, }\BuiltInTok{max}\OperatorTok{=}\DecValTok{100}\NormalTok{)}
    
\NormalTok{    country }\OperatorTok{=}\NormalTok{ models.StringField(label}\OperatorTok{=}\StringTok{\textquotesingle{}Please write the country you live in\textquotesingle{}}\NormalTok{,}
\NormalTok{                            choices}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}Algeria\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Columbia\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}France\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Kenya\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Turkey\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Vietnam\textquotesingle{}}\NormalTok{])}
    
\NormalTok{    study\_year }\OperatorTok{=}\NormalTok{ models.IntegerField(label}\OperatorTok{=}\StringTok{\textquotesingle{}What year of study are you in?\textquotesingle{}}\NormalTok{,}
\NormalTok{                                 choices}\OperatorTok{=}\NormalTok{[}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{],}
\NormalTok{                                 widget}\OperatorTok{=}\NormalTok{widgets.RadioSelect)    }
    
\NormalTok{    comments }\OperatorTok{=}\NormalTok{ models.LongStringField(label}\OperatorTok{=}\StringTok{\textquotesingle{}Please write your comments here\textquotesingle{}}\NormalTok{)}

\CommentTok{\# ...}
\end{Highlighting}
\end{Shaded}

\end{codelisting}

\begin{figure}

{\centering \includegraphics{part_otree/survey_formatted.png}

}

\caption{This is how our survey looks now}

\end{figure}

Our survey looks pretty good now. For other options, see the
\href{https://otree.readthedocs.io/en/latest/forms.html\#forms}{Forms
section in oTree documentation}.

\hypertarget{summary}{%
\chapter{Summary}\label{summary}}

In summary, this book has no content whatsoever.

\part{Group Decisions}

\hypertarget{group-experiments}{%
\chapter{Group Experiments}\label{group-experiments}}

We are now moving forward towards experiments where particpants interact
with each other within a group. First let's talk about conceptual
differences between individual and group experiments and then lets talk
about how to tackle the challenges with it.

The first difference is about the variables. In the individual
experiment section, we defined all variables in \texttt{Player} class.
Each participant needed to access their own variables (and some
constants that are the same for everyone). In group experiments,
participants need to access the decisions made by other participants in
the group.

In oTree as expected this is done by using \texttt{Group} class. When I
am in the group, I can call some functions to get the variables defined
in my group, and also I can reach to other participants in my group and
their variables.

The second difference now is about the pages. In individual experiments,
participants were going through the pages at their own pace. In
contrast, in many group experiments, participants need to wait for each
other to make their decisions. oTree also handles these interactions.
You can put a \texttt{WaitPage}, which by default waits for all
participants in the group to reach that page before moving on to the
next page. You can also execute some functions once everyone in the
group reaches that page.

Then there are the questions like who matches who, and what are the
roles of the participants in a group. We will postpone these questionsto
the section Roles and Matching and we will begin with the case where
everybody in the group has the same role and interacts with everyone
else in the group. We will call this case \textbf{homogenous groups} and
then we will move on to \textbf{heterogenous groups} where participants
have different roles and interact with each other in different ways.

\begin{tcolorbox}[enhanced jigsaw, bottomrule=.15mm, titlerule=0mm, rightrule=.15mm, breakable, colframe=quarto-callout-note-color-frame, title=\textcolor{quarto-callout-note-color}{\faInfo}\hspace{0.5em}{Summary}, coltitle=black, colbacktitle=quarto-callout-note-color!10!white, colback=white, arc=.35mm, opacitybacktitle=0.6, bottomtitle=1mm, toptitle=1mm, leftrule=.75mm, toprule=.15mm, left=2mm, opacityback=0]

Some conceptual differences between individual and group experiments
are:

\begin{itemize}
\tightlist
\item
  In group experiments, participants need to access the decisions made
  by other participants in the group.
\item
  In group experiments, participants need to wait for each other to make
  their decisions.
\item
  In group experiments, participants can have different roles and can be
  matched with each other in different ways.
\end{itemize}

\end{tcolorbox}

\part{Roles and Matching}

\part{Apps}

\part{Real Time Interaction}

\part{Deploying Experiments}

\part{Cookbook Recipes}

\hypertarget{outsourcing-your-experiment}{%
\chapter{Outsourcing your
experiment}\label{outsourcing-your-experiment}}

\part{Crash Course: Python}

\hypertarget{introduction-to-python}{%
\chapter{Introduction to Python}\label{introduction-to-python}}

Here is python introduction

\hypertarget{sec-virtual-environments}{%
\chapter{Virtual Environments}\label{sec-virtual-environments}}

Here I will talk about virtual environments and how to use them.

\part{Crash Course: Git}

\part{Crash Course: HTML \& CSS}

\part{Crash Course: JavaScript}

\part{Crash Course: Terminal}

\bookmarksetup{startatroot}

\hypertarget{references}{%
\chapter*{References}\label{references}}
\addcontentsline{toc}{chapter}{References}

\markboth{References}{References}

\hypertarget{refs}{}
\begin{CSLReferences}{1}{0}
\leavevmode\vadjust pre{\hypertarget{ref-knuth84}{}}%
Knuth, Donald E. 1984. {``Literate Programming.''} \emph{Comput. J.} 27
(2): 97--111. \url{https://doi.org/10.1093/comjnl/27.2.97}.

\end{CSLReferences}



\end{document}
